# Contributor: Stefan Wagner <stw@bit-strickerei.de>
# Maintainer: Stefan Wagner <stw@bit-strickerei.de>
pkgname=mkinitcpio
pkgver=24
pkgrel=3
pkgdesc="Modular initramfs image creation utility"
url="https://projects.archlinux.org/mkinitcpio.git/"
arch="noarch"
license="GPL"
depends="bash kmod util-linux"
makedepends="asciidoc"
provides="mkinitfs"
triggers="$pkgname.trigger=/usr/share/kernel/*"
subpackages="$pkgname-doc"
source="https://sources.archlinux.org/other/$pkgname/$pkgname-$pkgver.tar.gz
	ash-path.patch
	busybox-path.patch
	bsdtar-bsdcpio.patch
	add-user-group.patch
	grep.patch
	find.patch
	ncurses.patch
	makefile.patch
	tmpdir.patch
	keymap_hook
	keymap_install
	mdev_hook
	mdev_install
	"
builddir="$srcdir/$pkgname-$pkgver"

build() {
	cd "$builddir"
}

check() {
	cd "$builddir"
	make check
}

package() {
	cd "$builddir"
	make DESTDIR="$pkgdir" install
	for i in keymap mdev; do
		install -Dm644 "$srcdir"/"$i"_hook "$pkgdir"/usr/lib/initcpio/hooks/"$i"
		install -Dm644 "$srcdir"/"$i"_install "$pkgdir"/usr/lib/initcpio/install/"$i"
	done
}

sha512sums="4ada6a5af6660525d54177af95fceb630fcd82340e6fe461387da6f9ff385e0239691107eafcdae1693b0531d7370841c527528d514498bb3c76c29acda1a133  mkinitcpio-24.tar.gz
6cf4d8eb7b6222f837180ab2452e69d65dc31dc8359c680a9c59f661836a7221ab8a55cc88c959a0dd9e8708f05c778ff688de2c119158e84babf55abab1b088  ash-path.patch
5bda9c38643e4e5ad47c1e95eed40899c83126cd2cc6ed0648911de626a683921cc59accfa3ceb745a60059a8c94a320b555f9bbb83ecca306bfd81d57a0e011  busybox-path.patch
35c402540c4de8462e00b8be2f36039119aa1b731f7575b169b08d8a0b77143f1c1fbb7cb78b79f01dbee3a8d041c49982f2ee7c6d80bc90e0b624f787a975f6  bsdtar-bsdcpio.patch
fc72866f104f21be319ad5d31e717b24c66f4a2362f146d9c3c92466a37c376da6b46dd9116966118543ca4d874a1c216c82e44ed81524364a58e5a362692bc4  add-user-group.patch
af59b8cd431b9b5e35477a535e6f970d28fbf12b6cbfe6e46e9edf262d931462e6f5db47f95b3529d0a974364006a0ce6336842af8ef30b8bcc29f49cc4d9479  grep.patch
30e5e77efcac378774fba091a57a9de542194fac7467ced880243497196f3b69fb270aac02bec53e70774a931cab3866549bf476f418e28299516c989dfaa9d6  find.patch
7a86ab572fc81d8baea32ca264f9d62a9877b24c348f29caa49ef277c374e546fc6033608cf305178a1de46cb430c6a831084a497f25020b7e2ae5917dec76e4  ncurses.patch
8b10ed0085887d88763cd91c0d0482b5dea3d9565e7d0bca38e0f44bd02cbe2a6c6992514d1925c3b9502171ab29e74588118c5805a1fe67d3bad2ac0c581631  makefile.patch
7edcb126313e45e7b86cd1bd81e005173320d1978d7537ce7fb319ec4f3534a8f5fd1cbf48e50e42b2c679aa4625be2630e4dfbf0674ad7ac7d70b15d253fc83  tmpdir.patch
f770215aa09fc4ea9130b81b58b369edfbc6d7af2070752ff09a88e033b43a33664c848011dcd67d64e395c1d9a927486ae2c4d9e1d3d313d27a9e66f69bf593  keymap_hook
393735e5532940c4b0e691088caed05fd08691871b61cc6aacd05b257ba7c993a5ee8d0bd302352cff601de98e749569ff82b87dc7ff75285cf4528d1da35c8f  keymap_install
8fdcd38bf67ee74efb0725acb90325b5214a4d6115120c3be216d180c4f8e931844d82f94c05c1b97250be7e32cdc20be85f37f536c33d543ee5fba5a2ee0848  mdev_hook
7121bc9b9737306cb6026e9b68d7e9ebfa7786b9c346ac5b968d6dc80572731bef6cdfacb20745f672c11050ebfae8e8f2ad57b35027f244c1ec931b21fc5fba  mdev_install"
